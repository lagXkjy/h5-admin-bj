webpackJsonp([27],{"0fZK":function(e,t){},TbID:function(e,t){},dwhD:function(e,t){},q2jL:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),s=i.n(a),n=i("fZjL"),r=i.n(n),o=i("83G7"),p=i("NYxO"),d={data:function(){return{id:"",apkUrl:"",upgradePoint:"",currentVersion:"",version:"",versionCode:"",appSide:1,appSides:[{type:1,name:"用户端"},{type:2,name:"店长端"}],appType:1,appTypes:[{type:1,name:"ios"},{type:2,name:"android"}],updateType:1,updateTypes:[{type:1,name:"强制更新"},{type:2,name:"提示更新"}]}},computed:{isCreate:function(){return!this.id}},watch:{$route:function(e){var t=this;this.isCreate||(this.id=e.query.version,this.getAppVerisonDetail({id:this.id}).then(function(e){t.upgradePoint=e.upgradePoint.replace(/\\n\\r/g,"\n\r"),t.versionCode=e.versionCode,t.apkUrl=e.apkUrl,t.updateType=e.isForce,t.version=e.version,t.currentVersion=e.version,t.appType=1==e.appType||3==e.appType?1:2,t.appSide=1==e.appType||2==e.appType?1:2}))},appSide:function(e){2==e?(this.updateTypes=[{type:1,name:"强制更新"}],2==this.updateType&&(this.updateType=1)):this.updateTypes=[{type:1,name:"强制更新"},{type:2,name:"提示更新"}]}},methods:s()({},Object(p.b)(["getAppVerisonDetail","updateAppVersion","addVersionConfig"]),{parseParams:function(e,t){return e?1==t?{appType:this.parseUserType(this.appSide,this.appType),versionCode:this.versionCode,iosVersion:this.version,version:this.version,isForce:this.updateType,apkUrl:this.apkUrl,upgradePoint:this.upgradePoint}:{appType:this.parseUserType(this.appSide,this.appType),versionCode:this.versionCode,androidVersion:this.version,version:this.version,isForce:this.updateType,apkUrl:this.apkUrl,upgradePoint:this.upgradePoint}:1==t?{id:this.id,appType:this.parseUserType(this.appSide,this.appType),versionCode:this.versionCode,isForce:this.updateType,iosVersion:this.version,version:this.version,apkUrl:this.apkUrl,upgradePoint:this.upgradePoint}:{id:this.id,appType:this.parseUserType(this.appSide,this.appType),versionCode:this.versionCode,isForce:this.updateType,androidVersion:this.version,version:this.version,apkUrl:this.apkUrl,upgradePoint:this.upgradePoint}},re_url:function(e){return/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/).*$/.test(e)},update:function(){var e=this;return this.version<this.currentVersion?(this.version=this.currentVersion,this.$notify.error("内部版本号不能小于之前的版本号, 且为整数")):this.re_url(this.apkUrl)?(this.$router.push({path:"/system/appVersion"}),void(this.isCreate?this.addVersionConfig(this.parseParams(this.isCreate,this.appType)).then(function(){e.$notify.success("操作成功")}).catch(function(){return e.$notify.error("操作失败")}):this.updateAppVersion(this.parseParams(this.isCreate,this.appType)).then(function(){e.$notify.success("操作成功")}).catch(function(){return e.$notify.error("操作失败")}))):this.$notify.error("请输入有效的网址,如http://www.baidu.com")},parseUserType:function(e,t){return 1==e?1==t?1:2:2==e?1==t?3:4:void 0}}),mounted:function(){var e=this;this.$nextTick(function(){e.id=e.$route.query.version,e.isCreate||e.getAppVerisonDetail({id:e.id}).then(function(t){e.upgradePoint=t.upgradePoint.replace(/\\n\\r/g,"\n\r"),e.versionCode=t.versionCode,e.apkUrl=t.apkUrl,e.currentVersion=t.version,e.updateType=t.isForce,e.appType=1==t.appType||3==t.appType?1:2,e.appSide=1==t.appType||2==t.appType?1:2,e.version=1==e.appType?t.iosVersion:t.androidVersion})})}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"versionConfig"},[i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("客户端")]),e._v(" "),i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.appSide,callback:function(t){e.appSide=t},expression:"appSide"}},e._l(e.appSides,function(e){return i("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})}))],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("平台")]),e._v(" "),i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.appType,callback:function(t){e.appType=t},expression:"appType"}},e._l(e.appTypes,function(e){return i("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})}))],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("更新类型")]),e._v(" "),i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.updateType,callback:function(t){e.updateType=t},expression:"updateType"}},e._l(e.updateTypes,function(e){return i("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})}))],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("App版本号")]),e._v(" "),i("el-input",{staticStyle:{width:"200px"},model:{value:e.version,callback:function(t){e.version=t},expression:"version"}})],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("外部版本号")]),e._v(" "),i("el-input",{staticStyle:{width:"200px"},model:{value:e.versionCode,callback:function(t){e.versionCode=t},expression:"versionCode"}})],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("更新链接")]),e._v(" "),i("el-input",{staticStyle:{width:"50%"},model:{value:e.apkUrl,callback:function(t){e.apkUrl=t},expression:"apkUrl"}})],1),e._v(" "),i("div",{staticClass:"appType"},[i("div",{staticClass:"subTitle"},[e._v("更新说明")]),e._v(" "),i("el-input",{staticStyle:{width:"50%"},attrs:{type:"textarea",autosize:{minRows:4}},model:{value:e.upgradePoint,callback:function(t){e.upgradePoint=t},expression:"upgradePoint"}})],1),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确认提交")])],1)},staticRenderFns:[]};var c=i("VU/8")(d,l,!1,function(e){i("TbID")},"data-v-6635cfea",null).exports,u={components:{SubPage:o.a,VersionConfig:c},props:{subPageInfo:{type:String}},computed:{subPageType:function(){return this.subPageInfo.split("=")[0]},ID:function(){return this.subPageInfo.split("=")[1]}},data:function(){return{}},methods:{routeCallback:function(){this.$router.push({path:"/system/appVersion"})}}},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("sub-page",{attrs:{mainTitle:"App版本配置",subTitle:"编辑App版本配置",routeCallback:this.routeCallback}},[t("version-config")],1)},staticRenderFns:[]};var v={data:function(){return{curPageSize:10,pageSizes:[10,20,30,40],curTotal:0,currentPage:0,activeSide:"用户端",userSide:[],managerSide:[],isLoading:!1,editingItem:{},dialogTitle:"",dialogContent:"",dialogVisible:!1}},components:{VersionSubPage:i("VU/8")(u,h,!1,function(e){i("0fZK")},"data-v-7766373e",null).exports},beforeRouteEnter:function(e,t,i){i(function(e){e.$nextTick(function(){e.fetchUserSideData(),e.fetchManagerSideData()})})},computed:{routeQuery:function(){return r()(this.$route.query)[0]+"="+this.$route.query[r()(this.$route.query)[0]]},isLoadSubPage:function(){return!r()(this.$route.query)[0]},datas:function(){return"用户端"===this.activeSide?this.userSide:this.managerSide}},watch:{$route:function(e){this.refreshData()},activeSide:function(e){"用户端"===e?this.fetchUserSideData():this.fetchManagerSideData()}},methods:s()({},Object(p.b)(["getAppVersionList","updateAppVersion"]),{handleCurrentChange:function(e){this.currentPage=e,"用户端"===this.activeSide?this.fetchUserSideData(e,this.curPageSize):this.fetchManagerSideData()},handleSizeChange:function(e){this.curPageSize=e,"用户端"===this.activeSide?this.fetchUserSideData(this.currentPage,e):this.fetchManagerSideData()},handleClose:function(e){this.editingItem={},this.dialogTitle="",this.dialogContent="",e()},mapPagination:function(e){this.currentPage=e.pageNum<1?1:e.pageNum,this.curTotal=e.total,this.curPageSize=e.pageSize},showDialog:function(e,t){this.dialogTitle=e,this.editingItem=t,this.dialogContent="发布"===e?"一经确认发布后会立即生效到APP端，且不可取消":"一经确认删除后此条信息会清空，且不可恢复",this.dialogVisible=!0},editVersion:function(e){this.$router.push({path:"/system/appVersion?version="+e.id})},addVersionConfig:function(){this.$router.push({path:"/system/appVersion?version="})},removeAppVersion:function(){var e=this;this.updateAppVersion({id:this.editingItem.id,status:2}).then(function(){e.$notify.success("删除成功"),e.refreshData()}).catch(function(){e.$notify.error("删除失败")})},publishAppVersion:function(){var e=this;this.updateAppVersion({id:this.editingItem.id,appRelease:1}).then(function(){e.$notify.success("发布成功"),e.refreshData()}).catch(function(){e.$notify.error("发布失败")})},update:function(){"发布"===this.dialogTitle?this.publishAppVersion():this.removeAppVersion(),this.dialogVisible=!1},refreshData:function(){this.fetchUserSideData(),this.fetchManagerSideData()},mapUserSide:function(e){var t=this,i=[];return e.forEach(function(e,a){var s={};s.createTime=t.moment(e.createTime).format("YYYY-MM-DD HH:mm:ss"),s.updateTime=e.releaseTime?t.moment(e.releaseTime).format("YYYY-MM-DD HH:mm:ss"):"",s.side="用户端",s.id=e.id,s.versionCode=e.versionCode,s.upgradePoint=e.upgradePoint.replace(/\\n\\r/g,"\n\r"),s.appType=1==e.appType?"ios":2==e.appType?"android":"",s.apkUrl=e.apkUrl,s.isForce=1==e.isForce?"强制更新":2==e.isForce?"提示更新":"",s.appRelease=1==e.appRelease?"已发布":2==e.appRelease?"未发布":"",i.push(s)}),i},mapManagerSide:function(e){var t=this,i=[];return e.forEach(function(e,a){var s={};s.createTime=t.moment(e.createTime).format("YYYY-MM-DD HH:mm:ss"),s.updateTime=e.releaseTime?t.moment(e.releaseTime).format("YYYY-MM-DD HH:mm:ss"):"",s.side="店长端",s.id=e.id,s.versionCode=e.versionCode,s.upgradePoint=e.upgradePoint.replace(/\\n\\r/g,"\n\r"),s.appType=3==e.appType?"ios":4==e.appType?"android":"",s.apkUrl=e.apkUrl,s.isForce=1==e.isForce?"强制更新":2==e.isForce?"提示更新":"",s.appRelease=1==e.appRelease?"已发布":2==e.appRelease?"未发布":"",i.push(s)}),i},fetchUserSideData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.isLoading=!0,this.getAppVersionList({appKind:1,page:t,size:i}).then(function(t){e.isLoading=!1,e.userSide=e.mapUserSide(t.list),"用户端"===e.activeSide&&e.mapPagination(t)}).catch(function(){e.isLoading=!1})},fetchManagerSideData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.isLoading=!0,this.getAppVersionList({appKind:2,page:t,size:i}).then(function(t){e.isLoading=!1,e.managerSide=e.mapManagerSide(t.list),"店长端"===e.activeSide&&e.mapPagination(t)}).catch(function(){e.isLoading=!1})}}),mounted:function(){var e=this;this.$nextTick(function(){e.fetchUserSideData(),e.fetchManagerSideData()})}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isLoadSubPage?i("div",{staticClass:"protalPage"},[i("div",{staticClass:"appVersionPage"},[i("div",{staticClass:"title"},[e._v("\n      APP版本配置\n    ")]),e._v(" "),i("div",{directives:[{name:"permission",rawName:"v-permission",value:"47132837-f28b-406d-9a4d-0c1b8b90c8e1",expression:"'47132837-f28b-406d-9a4d-0c1b8b90c8e1'"}],staticClass:"selector"},[i("el-radio-group",{model:{value:e.activeSide,callback:function(t){e.activeSide=t},expression:"activeSide"}},[i("el-radio-button",{attrs:{label:"用户端"}}),e._v(" "),i("el-radio-button",{attrs:{label:"店长端"}})],1),e._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"e9341fd0-492c-4f07-9499-400de8671ffc",expression:"'e9341fd0-492c-4f07-9499-400de8671ffc'"}],on:{click:e.addVersionConfig}},[e._v("新增")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"},{name:"permission",rawName:"v-permission",value:"47132837-f28b-406d-9a4d-0c1b8b90c8e1",expression:"'47132837-f28b-406d-9a4d-0c1b8b90c8e1'"}],staticStyle:{width:"100%"},attrs:{data:e.datas}},[i("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e._v(e._s(t.row.createTime.split(" ")[0]))]),e._v(" "),i("div",[e._v(e._s(t.row.createTime.split(" ")[1]))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"updateTime",label:"发布时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e._v(e._s(t.row.updateTime.split(" ")[0]))]),e._v(" "),i("div",[e._v(e._s(t.row.updateTime.split(" ")[1]))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"side",label:"客户端",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"appType",label:"平台"}}),e._v(" "),i("el-table-column",{attrs:{prop:"versionCode",label:"版本号",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"isForce",label:"更新类型",width:"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"apkUrl",label:"链接地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{attrs:{href:t.row.apkUrl,target:"_blank"}},[e._v(e._s(t.row.apkUrl))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"address",label:"更新说明"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{type:"textarea",autosize:{minRows:4},value:e.row.upgradePoint,resize:"none",disabled:""}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"appRelease",label:"状态",width:"80"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["已发布"!==t.row.appRelease?i("div",{staticClass:"table_button"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"4190f81a-cd2e-4024-8b93-009f4fb380c4",expression:"'4190f81a-cd2e-4024-8b93-009f4fb380c4'"}],attrs:{type:"success",plain:""},on:{click:function(i){e.showDialog("发布",t.row)}}},[e._v("发布")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"1032b656-0fba-4048-b743-68af4dfdeab1",expression:"'1032b656-0fba-4048-b743-68af4dfdeab1'"}],attrs:{type:"primary",plain:""},on:{click:function(i){e.editVersion(t.row)}}},[e._v("编辑")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"3bd3e29d-c51d-4980-832e-4826cc447a86",expression:"'3bd3e29d-c51d-4980-832e-4826cc447a86'"}],attrs:{type:"danger",plain:""},on:{click:function(i){e.showDialog("删除",t.row)}}},[e._v("删除")])],1):e._e()]}}])})],1),e._v(" "),i("div",{directives:[{name:"permission",rawName:"v-permission",value:"47132837-f28b-406d-9a4d-0c1b8b90c8e1",expression:"'47132837-f28b-406d-9a4d-0c1b8b90c8e1'"}],staticClass:"paginationBox"},[i("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.curPageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.curTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),i("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%",center:"","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"subTitle",staticStyle:{"text-align":"center"}},[e._v("确认要"+e._s(e.dialogTitle)+"吗?")]),e._v(" "),i("div",{staticClass:"dialogContent",staticStyle:{"text-align":"center"}},[e._v(e._s(e.dialogContent))]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 认")])],1)])],1)]):i("version-sub-page",{attrs:{subPageInfo:e.routeQuery}})},staticRenderFns:[]};var g=i("VU/8")(v,f,!1,function(e){i("dwhD")},"data-v-42f46338",null);t.default=g.exports}});
//# sourceMappingURL=27.faa0a60bc247e0b62fdb.js.map