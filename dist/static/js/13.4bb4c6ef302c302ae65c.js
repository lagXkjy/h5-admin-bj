webpackJsonp([13],{"+F4T":function(t,e){},IAWe:function(t,e){},OrgU:function(t,e){},tRdW:function(t,e){},u86v:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("fZjL"),s=i.n(a),r=i("Dd8w"),n=i.n(r),l=i("JaHG"),o={props:{tableData:{type:Array,default:function(){return[]}}},computed:{datas:function(){var t=Object(l.b)(this.tableData);return t.forEach(function(t,e){t.createTime=moment(t.createTime).format("YYYY-MM-DD HH:mm:ss"),t.source=1==t.source?"系统":2==t.source?"店长":3==t.source?"用户":"",t.handleStatus=1==t.handleStatus?"待处理":2==t.handleStatus?"处理中":3==t.handleStatus?"已处理":""}),t}},data:function(){return{headStyle:{}}},methods:{handleEdit1:function(t,e){},handleEdit2:function(t,e){},handleEdit3:function(t,e){},handleEdit4:function(t,e){},checkErrorDetail:function(t){this.$router.push({path:"/operation/error?errorDetail="+t.id})}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"errorTable"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.datas,"header-cell-style":t.headStyle}},[i("el-table-column",{attrs:{label:"上报时间",prop:"createTime"}}),t._v(" "),i("el-table-column",{attrs:{label:"设备ID",prop:"facilityId"}}),t._v(" "),i("el-table-column",{attrs:{label:"设备名称",prop:"facilityName"}}),t._v(" "),i("el-table-column",{attrs:{label:"所属门店",prop:"storeName"}}),t._v(" "),i("el-table-column",{attrs:{label:"异常报备",prop:"abnormalCode"}}),t._v(" "),i("el-table-column",{attrs:{label:"路径",prop:"source",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"状态",prop:"handleStatus"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"5454e38b-8cab-4b3c-aa2b-975be4c82690",expression:"'5454e38b-8cab-4b3c-aa2b-975be4c82690'"}],attrs:{size:"small"},nativeOn:{click:function(i){t.checkErrorDetail(e.row)}}},[t._v("详情")])]}}])})],1)],1)},staticRenderFns:[]};var u=i("VU/8")(o,c,!1,function(t){i("OrgU")},"data-v-1c731d84",null).exports,d=i("83G7"),m=i("woOf"),v=i.n(m),f=i("NYxO"),h={props:{currentNum:{type:Number,default:0},stepNum:{type:Number,default:0},stepTime:{type:String,default:"2018-01-01"},stepHandleUserInfo:{type:String,default:"处理人"},stepHandleRemark:{type:String,default:"处理说明"}},data:function(){return{successStatusStyle:{color:"#1f52f1"},stepIconStyle:{backgroundColor:"#1f52f1"}}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"stepContent",style:1==t.stepNum||0==t.currentNum?t.successStatusStyle:""},[i("div",{staticClass:"step_time"},[t._v(t._s(t.stepTime))]),t._v(" "),i("div",{staticClass:"step_status"},[i("div",{staticClass:"step_icon",style:1==t.stepNum||0==t.currentNum?t.stepIconStyle:""}),t._v(" "),t.stepNum>1&&t.currentNum!==t.stepNum-1?i("div",{staticClass:"step_line"}):t._e()]),t._v(" "),i("div",{staticClass:"step_content"},[i("div",{staticClass:"step_userInfo"},[t._v(t._s(t.stepHandleUserInfo))]),t._v(" "),i("div",{staticClass:"step_description"},[t._v(t._s(t.stepHandleRemark))])])])},staticRenderFns:[]};var _={data:function(){return{logs:"",id:"",deviceDetail:{},errorDetail:[],processStream:[],input:"",handleStatus:1,abnormalId:0,abnormalCode:0,dialogVisible:!1,currentUrl:""}},components:{AdminStep:i("VU/8")(h,p,!1,function(t){i("IAWe")},"data-v-30c7e061",null).exports},computed:n()({},Object(f.e)({userInformation:function(t){return t.auth.userInformation}}),{_screenHeight:function(){return window.document.body.offsetHeight}}),watch:{$route:function(t){this.id=t.query.errorDetail},id:function(){var t=this;this.getErrorDetail({id:this.id}).then(function(e){t.deviceDetail=v()({},e.facilityResult,{createTime:moment(e.facilityResult.createTime).format("YYYY-MM-DD HH:mm:ss"),bindingTime:e.facilityResult.bindingTime?moment(e.facilityResult.bindingTime).format("YYYY-MM-DD HH:mm:ss"):"无"}),t.handleStatus=e.abnormalResult.handleStatus,e.facilityHandleResult.list.forEach(function(t,e){t.createTime=moment(t.createTime).format("YYYY-MM-DD HH:mm:ss").toString()}),t.processStream=e.facilityHandleResult.list}),this.getErrorInfoList({abnormalId:this.id}).then(function(e){e.forEach(function(e,i){e.createTime=t.moment(e.createTime).format("YYYY-MM-DD HH:mm:ss")}),t.errorDetail=e}).catch(function(e){t.$notify.error(e)})}},created:function(){this.id=this.$route.query.errorDetail},methods:n()({},Object(f.b)(["getErrorDetail","getErrorInfoList","addErrorLog"]),{handleClose:function(t){t()},showImg:function(t){this.currentUrl=t,this.dialogVisible=!0},addLog:function(){var t=this;if(!this.logs)return this.$notify.error("处理日志内容不能为空");this.addErrorLog({facilityId:this.deviceDetail.id,abnormalId:this.abnormalId,abnormalCode:this.abnormalCode,userId:this.userInformation.id,userName:this.userInformation.username,handleResult:this.logs}).then(function(e){t.$notify.success("操作成功"),t.getErrorDetail({id:t.id}).then(function(e){t.deviceDetail=v()({},e.facilityResult,{createTime:moment(e.facilityResult.createTime).format("YYYY-MM-DD HH:mm:ss"),bindingTime:e.facilityResult.bindingTime?moment(e.facilityResult.bindingTime).format("YYYY-MM-DD HH:mm:ss"):"无"}),t.handleStatus=e.abnormalResult.handleStatus,e.facilityHandleResult.list.forEach(function(t,e){t.createTime=moment(t.createTime).format("YYYY-MM-DD HH:mm:ss").toString()}),t.processStream=e.facilityHandleResult.list})}).catch(function(e){t.$notify.error("操作失败")})}}),mounted:function(){var t=this;this.$nextTick(function(){t.getErrorDetail({id:t.id}).then(function(e){t.deviceDetail=v()({},e.facilityResult,{createTime:moment(e.facilityResult.createTime).format("YYYY-MM-DD HH:mm:ss"),bindingTime:e.facilityResult.bindingTime?moment(e.facilityResult.bindingTime).format("YYYY-MM-DD HH:mm:ss"):"无"}),t.handleStatus=e.abnormalResult.handleStatus,t.abnormalId=e.abnormalResult.id,t.abnormalCode=e.abnormalResult.abnormalCode,e.facilityHandleResult.list.forEach(function(t,e){t.createTime=moment(t.createTime).format("YYYY-MM-DD HH:mm:ss").toString()}),t.processStream=e.facilityHandleResult.list}),t.getErrorInfoList({abnormalId:t.id}).then(function(e){e.forEach(function(e,i){e.createTime=t.moment(e.createTime).format("YYYY-MM-DD HH:mm:ss")}),t.errorDetail=e}).catch(function(e){t.$notify.error(e)})})}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"errorDetailPage"},[i("div",{staticClass:"handleStatus"},[t._v("\n      处理状态: "+t._s(1==t.handleStatus?"待处理":2==t.handleStatus?"处理中":3==t.handleStatus?"已处理":"")+"\n    ")]),t._v(" "),t.deviceDetail?i("div",{staticClass:"error_device"},[i("div",{staticClass:"subTitle"},[t._v("\n        基本信息\n      ")]),t._v(" "),i("div",{staticClass:"device_detail"},[i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("设备类型")]),t._v(t._s(1==t.deviceDetail.facilityKind?"运动设备":2==t.deviceDetail.facilityKind?"弱电设备":3==t.deviceDetail.facilityKind?"其他设备":"未知类型的设备"))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("设备名称")]),t._v(t._s(t.deviceDetail.facilityName))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("设备ID")]),t._v(t._s(t.deviceDetail.id))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("设备厂商")]),t._v(t._s(t.deviceDetail.facilityFirm))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("入库时间")]),t._v(t._s(t.deviceDetail.createTime))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("绑定时间")]),t._v(t._s(t.deviceDetail.bindingTime?t.deviceDetail.bindingTime:""))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("所属门店")]),t._v(t._s(t.deviceDetail.storeName))]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("已运行")]),t._v(t._s(t.deviceDetail.runningTime)+"分钟")]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("异常报备")]),t._v(t._s(t.deviceDetail.abnormalCount)+"次")]),t._v(" "),i("div",{staticClass:"device_item"},[i("div",{staticClass:"item_subTitle"},[t._v("已维修")]),t._v(t._s(t.deviceDetail.repairedCount)+"次")])])]):i("div",{staticClass:"error_device"},[t._v("暂无设备信息及异常信息")]),t._v(" "),i("div",{staticClass:"error_device"},[i("div",{staticClass:"subTitle"},[t._v("\n        上报异常信息\n      ")]),t._v(" "),t._l(t.errorDetail,function(e,a){return i("div",{key:a,staticClass:"error_detail"},[i("div",{staticClass:"detail_left"},[i("div",{staticClass:"error_header",style:1==t.errorDetail.length||0===a?"background-color: #0066FF; color: #ffffff":""},[t._v(t._s(1==e.source?"系统":2==e.source?"店长":3==e.source?"用户":""))]),t._v(" "),0!==t.errorDetail.length&&a!==t.errorDetail.length-1?i("div",{staticClass:"left_line"}):t._e()]),t._v(" "),i("div",{staticClass:"error_content"},[i("div",{staticClass:"error_item"},[i("div",{staticClass:"item_subTitle"},[t._v("上报时间")]),t._v(t._s(e.createTime))]),t._v(" "),i("div",{staticClass:"error_item"},[i("div",{staticClass:"item_subTitle"},[t._v("上报路径")]),t._v(t._s(1==e.source?"系统":2==e.source?"店长":3==e.source?"用户":"")+" "),i("span",{staticStyle:{"font-size":"14px",color:"#666666"}},[t._v(t._s(e.userInfo?"(昵称:"+e.userInfo.nickname+",ID:"+e.userInfo.userId+")":2==e.source?"(店长:"+e.manegeName+",ID:"+e.manegeId+")":""))])]),t._v(" "),i("div",{staticClass:"error_item"},[i("div",{staticClass:"item_subTitle"},[t._v("异常代码")]),t._v(t._s(e.abnormalCode))]),t._v(" "),i("div",{staticClass:"error_item"},[i("div",{staticClass:"item_subTitle"},[t._v("异常描述")]),t._v(t._s(e.abnormalDescribe))]),t._v(" "),i("div",{staticClass:"error_item"},[i("div",{staticClass:"item_subTitle",staticStyle:{height:"100%"}},[t._v("上传图片")]),t._v(" "),t._l(e.abnormalPic.split(";"),function(e,a){return i("div",{key:a,staticClass:"pics",staticStyle:{display:"inline-block"}},[i("img",{staticStyle:{width:"100px",height:"100px","margin-right":"20px",cursor:"pointer"},attrs:{src:e,alt:""},on:{click:function(i){t.showImg(e)}}})])})],2)])])})],2),t._v(" "),i("el-dialog",{attrs:{title:"图片",visible:t.dialogVisible,"before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{style:""},[i("img",{attrs:{src:t.currentUrl,alt:""}})])]),t._v(" "),i("div",{staticClass:"error_process",staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"subTitle",staticStyle:{"margin-bottom":"20px"}},[t._v("维修流程")]),t._v(" "),t.processStream&&t.processStream.length>0?i("div",{staticClass:"process_steps",style:"height: "+100*t.processStream.length+"px"},t._l(t.processStream,function(e,a){return i("admin-step",{key:a,attrs:{currentNum:a,stepNum:t.processStream.length,stepTime:e.createTime,stepHandleUserInfo:(1==e.handleUserType?"店长":2==e.handleUserType?"系统":"")+" : "+e.handleAgent+" ID:"+e.handleUserId,stepHandleRemark:"说明: "+(e.handleResult?e.handleResult:"无")+" 进度: "+(1==e.handleType?"跟进":2==e.handleType?"处理完成":"无")}})})):i("div",[t._v("暂无处理流程")])]),t._v(" "),i("div",{staticClass:"errorLog"},[i("div",{staticClass:"subTitle",staticStyle:{"margin-bottom":"20px"}},[t._v("处理记录日志")]),t._v(" "),i("div",{staticStyle:{width:"400px","margin-bottom":"30px"}},[i("el-input",{staticStyle:{width:"400px",row:"5"},attrs:{type:"textarea",placeholder:"记录日志"},model:{value:t.logs,callback:function(e){t.logs=e},expression:"logs"}})],1),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.processStream[0]&&2==t.processStream[0].handleType},on:{click:t.addLog}},[t._v("提交")])],1)],1)},staticRenderFns:[]};var g=i("VU/8")(_,b,!1,function(t){i("+F4T")},"data-v-4dd1b954",null).exports,y={components:{SubPage:d.a,ErrorDetail:g},props:{subPageInfo:{type:String}},computed:{subPageType:function(){return this.subPageInfo.split("=")[0]}},methods:{routeCallback:function(){this.$router.push({path:"/error"})}},data:function(){return{}}},D={render:function(){var t=this.$createElement,e=this._self._c||t;return this.subPageInfo?e("sub-page",{key:"1",attrs:{mainTitle:"设备异常",subTitle:"设备异常处理详情",routeCallback:this.routeCallback}},["errorDetail"===this.subPageType?e("error-detail"):this._e()],1):this._e()},staticRenderFns:[]};var C={name:"error",components:{ErrorTable:u,ErrorSubPage:i("VU/8")(y,D,!1,function(t){i("tRdW")},"data-v-1f470538",null).exports},data:function(){return{time:[],currentPage4:1,pageSizes:[10,20,30,40],curPageSize:10,curTotal:0,deviceStatus:"已绑设备",input:"",store:"all",statusOptions:[{value:"all",label:"全部"},{value:1,label:"待处理"},{value:2,label:"处理中"},{value:3,label:"已处理"}],status:"all",source:"all",sourceOptions:[{value:"all",label:"全部"},{value:1,label:"系统"},{value:2,label:"店长"},{value:3,label:"用户"}]}},watch:{store:function(){this.fetchData()},status:function(){this.fetchData()},time:function(){this.fetchData()},source:function(){this.fetchData()}},computed:n()({},Object(f.e)({errorList:function(t){return t.error.errorList},isFetchingData:function(t){return t.error.isFetchingData},pageSize:function(t){return t.error.pageSize},pageNum:function(t){return t.error.pageNum},total:function(t){return t.error.total},errorDropdownStoreList:function(t){return t.error.errorDropdownStoreList}}),{storeList:function(){var t=Object(l.b)(this.errorDropdownStoreList);return t.unshift({storeName:"全部门店",id:"all"}),t},routeQuery:function(){return s()(this.$route.query)[0]+"="+this.$route.query[s()(this.$route.query)[0]]},isLoadSubPage:function(){return!s()(this.$route.query)[0]}}),methods:n()({},Object(f.b)(["getErrorList","getErrorDropDownStoreList"]),{handleSizeChange:function(t){this.curPageSize=t,this.fetchData()},handleCurrentChange:function(t){this.currentPage4=t,this.fetchData()},mapPagination:function(){this.currentPage4=this.pageNum,this.curTotal=this.total,this.curPageSize=this.pageSize},computeParams:function(){var t={};return"all"!==this.status&&(t.handleStatus=this.status),this.time.length>0&&(t.beginTime=this.time[0],t.endTime=this.time[1]),this.input&&(t.facilityId=this.input),"all"!==this.store&&(t.storeId=this.store),"all"!==this.source&&(t.source=this.source),t.page=this.currentPage4,t.size=this.curPageSize,t},fetchData:function(){var t=this;this.getErrorList(this.computeParams()).then(function(){t.mapPagination()})}}),beforeRouteEnter:function(t,e,i){i(function(t){t.$nextTick(function(){t.fetchData()})})},mounted:function(){var t=this;this.$nextTick(function(){t.getErrorDropDownStoreList().then(function(){t.fetchData()})})}},S={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLoadSubPage?i("div",{staticClass:"protalPage"},[i("div",{staticClass:"activityPage"},[i("div",{staticClass:"title"},[t._v("\n      设备异常\n    ")]),t._v(" "),i("div",{staticClass:"searchBar",staticStyle:{width:"300px","margin-top":"20px"}},[i("el-input",{attrs:{placeholder:"输入设备ID,回车搜索"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.fetchData(e)}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1),t._v(" "),i("div",{staticClass:"selects"},[i("div",{staticClass:"statusSelect"},[i("span",[t._v("门店")]),t._v(" "),i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.store,callback:function(e){t.store=e},expression:"store"}},t._l(t.storeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.storeName,value:t.id}})}))],1),t._v(" "),i("div",{staticClass:"statusSelect"},[i("span",[t._v("状态")]),t._v(" "),i("el-select",{staticStyle:{width:"100px","margin-right":"15px"},attrs:{placeholder:"请选择"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.statusOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),i("span",[t._v("路径")]),t._v(" "),i("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:t.source,callback:function(e){t.source=e},expression:"source"}},t._l(t.sourceOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),i("div",{staticClass:"timeSelect",staticStyle:{"margin-left":"15px","margin-right":"15px"}},[i("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1)]),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isFetchingData,expression:"isFetchingData"},{name:"permission",rawName:"v-permission",value:"9629f07f-25e0-486f-ac7d-838270172dfc",expression:"'9629f07f-25e0-486f-ac7d-838270172dfc'"}],staticClass:"messageTableBox"},[i("error-table",{attrs:{tableData:t.errorList}}),t._v(" "),i("div",{staticClass:"paginationBox"},[i("el-pagination",{attrs:{"current-page":t.currentPage4,"page-sizes":t.pageSizes,"page-size":t.curPageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.curTotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)])]):i("error-sub-page",{attrs:{subPageInfo:t.routeQuery}})},staticRenderFns:[]};var T=i("VU/8")(C,S,!1,function(t){i("vcmc")},"data-v-869fe34c",null);e.default=T.exports},vcmc:function(t,e){}});
//# sourceMappingURL=13.4bb4c6ef302c302ae65c.js.map