webpackJsonp([17],{"1nT2":function(e,t){},"4mSX":function(e,t){},"8imL":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("fZjL"),i=a.n(s),n=a("Dd8w"),l=a.n(n),r=a("NYxO"),c=a("JaHG"),o={props:{tableData:{type:Array,default:function(){return[]}}},computed:l()({},Object(r.e)({checkingMessageDetail:function(e){return e.message.checkingMessageDetail}}),{currentDetail:function(){var e=Object(c.b)(this.checkingMessageDetail);return e.createTime=moment(e.createTime).format("YYYY-MM-DD HH:mm:ss"),e.sendType=1==e.sendType?"短信":2==e.sendType?"app推送":3==e.sendType?"系统消息":"未知的类型",e.userType=e.userType=1==e.userType?"店长":2==e.userType?"用户":"其他",e},datas:function(){var e=Object(c.b)(this.tableData);return e.forEach(function(e,t){e.createTime=moment(e.createTime).format("YYYY-MM-DD HH:mm:ss"),e.sendType=1==e.sendType?"短信":2==e.sendType?"app推送":3==e.sendType?"系统消息":"未知的类型",e.userType=1==e.userType?"店长":2==e.userType?"用户":"其他",e.sendStatus=0==e.sendStatus?"待发送":1==e.sendStatus?"已发送":2==e.sendStatus?"发送失败":"未知的发送状态"}),e}}),data:function(){return{headStyle:{},showDialog:!1,isFetchingDetail:!1}},methods:l()({},Object(r.b)(["getMessageDetail"]),{handleEdit1:function(e,t){},handleEdit2:function(e,t){},handleEdit3:function(e,t){},handleEdit4:function(e,t){},handleClose:function(e){e(),this.showDialog=!1},checkMessageDetail:function(e){var t=this;this.showDialog=!0,this.isFetchingDetail=!0;var a=e.id;this.getMessageDetail({id:a}).then(function(){t.isFetchingDetail=!1}).catch(function(){t.isFetchingDetail=!1})}})},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"storeTable pageTable"},[a("el-dialog",{attrs:{title:"消息详情",visible:e.showDialog,width:"30%","before-close":e.handleClose,center:""},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isFetchingDetail,expression:"isFetchingDetail"}],staticClass:"content",staticStyle:{width:"100%"}},[a("div",{staticClass:"detailTitle"},[e._v("标题: "+e._s(e.currentDetail.title))]),e._v(" "),a("div",{staticClass:"detailContent"},[e._v("内容: "+e._s(e.currentDetail.content))]),e._v(" "),a("div",{staticStyle:{width:"100%",height:"1px",backgroundColor:"#999999"}}),e._v(" "),a("div",{staticClass:"sendTime"},[e._v("发布时间: "+e._s(e.currentDetail.createTime))]),e._v(" "),a("div",{staticClass:"sendName"},[e._v("发布人: "+e._s(e.currentDetail.createName))]),e._v(" "),a("div",{staticClass:"sendType"},[e._v("消息类型: "+e._s(e.currentDetail.sendType))]),e._v(" "),a("div",{staticClass:"reciveType"},[e._v("接收群体: "+e._s(e.currentDetail.userType))])])]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.datas,"header-cell-style":e.headStyle}},[a("el-table-column",{attrs:{label:"发布时间",prop:"createTime"}}),e._v(" "),a("el-table-column",{attrs:{label:"消息类型",prop:"sendType"}}),e._v(" "),a("el-table-column",{attrs:{label:"接收群体",prop:"userType"}}),e._v(" "),a("el-table-column",{attrs:{label:"标题",prop:"title"}}),e._v(" "),a("el-table-column",{attrs:{label:"发布人",prop:"createName"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"sendStatus"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"fb891617-ac7f-4aee-8680-211ac3477a64",expression:"'fb891617-ac7f-4aee-8680-211ac3477a64'"}],attrs:{size:"small"},nativeOn:{click:function(a){e.checkMessageDetail(t.row)}}},[e._v("查看详情")])]}}])})],1)],1)},staticRenderFns:[]};var d=a("VU/8")(o,u,!1,function(e){a("x6X7")},"data-v-5f44b49c",null).exports,p=a("83G7"),h={data:function(){return{messageType:"系统消息",receiveType:"all",showDialog:!1,messageTitle:"",messageContent:"",contentRow:5,maxlength:50,maxlength2:500,sendType:"3",messageTypeOptions:[{value:"3",label:"系统消息"},{value:"2",label:"APP推送"}],receiveTypeOptions:[{value:"all",label:"全部"},{value:1,label:"店长端"},{value:2,label:"用户端"}]}},computed:l()({},Object(r.e)({userInformation:function(e){return e.auth.userInformation}}),{currentTitleLength:function(){return this.messageTitle.length},currentContentLength:function(){return this.messageContent.length}}),watch:{},methods:l()({},Object(r.b)(["sendMessages"]),{handleClose:function(e){e()},confirmSend:function(){var e=this;this.$router.push({path:"/operation/message"}),"all"!==this.receiveType?this.sendMessages({userType:this.receiveType,pushType:2,sendType:this.sendType,title:this.messageTitle,content:this.messageContent,createUid:this.userInformation.id,createName:this.userInformation.username}).then(function(){e.$notify.success("消息群发成功"),e.$router.push({path:"/operation/message"}),e.$emit("refreshMessageList")}):this.sendMessages({userType:1,pushType:2,sendType:this.sendType,title:this.messageTitle,content:this.messageContent,createUid:this.userInformation.id,createName:this.userInformation.username}).then(function(){e.sendMessages({userType:2,pushType:2,sendType:e.sendType,title:e.messageTitle,content:e.messageContent,createUid:e.userInformation.id,createName:e.userInformation.username}).then(function(){e.$notify.success("消息群发成功"),e.$emit("refreshMessageList")})})},preview:function(){this.showDialog=!0}})},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"createMessagePage"},[a("el-dialog",{attrs:{title:"消息预览",visible:e.showDialog,width:"30%","before-close":e.handleClose,center:""},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{staticClass:"content",staticStyle:{width:"100%"}},[a("div",{staticClass:"detailTitle"},[e._v("标题: "+e._s(e.messageTitle))]),e._v(" "),a("div",{staticClass:"detailContent"},[e._v("内容: "+e._s(e.messageContent))]),e._v(" "),a("div",{staticStyle:{width:"100%",height:"1px",backgroundColor:"#999999"}}),e._v(" "),a("div",{staticClass:"sendTime"},[e._v("发布时间: -")]),e._v(" "),a("div",{staticClass:"sendName"},[e._v("发布人: "+e._s(e.userInformation.username))]),e._v(" "),a("div",{staticClass:"sendType"},[e._v("消息类型: "+e._s("3"==e.sendType?"系统消息":"2"==e.sendType?"APP推送":""))]),e._v(" "),a("div",{staticClass:"reciveType"},[e._v("接收群体: "+e._s("all"==e.receiveType?"全部":1==e.receiveType?"店长端":2==e.receiveType?"用户端":"-"))])])]),e._v(" "),a("div",{staticClass:"createMessageTitle"},[e._v("新建消息")]),e._v(" "),a("div",{staticClass:"selectTypes"},[a("div",{staticClass:"selectMessageType"},[a("div",{staticClass:"subTitle"},[e._v("消息类型")]),e._v(" "),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},model:{value:e.sendType,callback:function(t){e.sendType=t},expression:"sendType"}},e._l(e.messageTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",{staticClass:"selectReceiveType"},[a("div",{staticClass:"subTitle"},[e._v("接收群体")]),e._v(" "),a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.receiveType,callback:function(t){e.receiveType=t},expression:"receiveType"}},e._l(e.receiveTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)]),e._v(" "),a("div",{staticClass:"subTitle"},[e._v("标题("+e._s(e.currentTitleLength)+"/50)")]),e._v(" "),a("el-input",{attrs:{placeholder:"输入标题(限50字符)",clearable:"",maxlength:e.maxlength},model:{value:e.messageTitle,callback:function(t){e.messageTitle=t},expression:"messageTitle"}}),e._v(" "),a("div",{staticClass:"subTitle"},[e._v("内容("+e._s(e.currentContentLength)+"/500)")]),e._v(" "),a("el-input",{attrs:{placeholder:"输入内容(限500字符)",clearable:"",maxlength:e.maxlength2,type:"textarea",rows:e.contentRow},model:{value:e.messageContent,callback:function(t){e.messageContent=t},expression:"messageContent"}}),e._v(" "),a("div",{staticClass:"buttons"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.confirmSend(t)}}},[e._v("确认群发")]),e._v(" "),a("el-button",{nativeOn:{click:function(t){e.preview(t)}}},[e._v("预览")])],1)],1)},staticRenderFns:[]};var g=a("VU/8")(h,v,!1,function(e){a("1nT2")},"data-v-6982dc24",null).exports,m={components:{SubPage:p.a,CreateMessage:g},props:{subPageInfo:{type:String}},computed:{subPageType:function(){return this.subPageInfo.split("=")[0]}},methods:{routeCallback:function(){this.$router.push({path:"/operation/message"})},refreshMessageList:function(){this.$emit("refreshMessage")}},data:function(){return{}}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return this.subPageInfo?t("sub-page",{key:"1",attrs:{mainTitle:"消息管理",subTitle:"新建消息",routeCallback:this.routeCallback}},["createMessage"===this.subPageType?t("create-message",{on:{refreshMessageList:this.refreshMessageList}}):this._e()],1):this._e()},staticRenderFns:[]};var b={components:{MessageTable:d,MessageSubPage:a("VU/8")(m,f,!1,function(e){a("Phjk")},"data-v-52d6df4a",null).exports},data:function(){return{time:[],currentPage4:1,pageSizes:[10,20,30,40],curPageSize:10,curTotal:0,deviceStatus:"已绑设备",input:"",options:[{value:"all",label:"全部类型"},{value:1,label:"短信"},{value:2,label:"app推送"},{value:3,label:"系统消息"}],value:"all"}},computed:l()({},Object(r.e)({messageList:function(e){return e.message.messageList},isFetchingData:function(e){return e.message.isFetchingData},pageSize:function(e){return e.message.pageSize},pageNum:function(e){return e.message.pageNum},total:function(e){return e.message.total}}),{routeQuery:function(){return i()(this.$route.query)[0]+"="+this.$route.query[i()(this.$route.query)[0]]},isLoadSubPage:function(){return!i()(this.$route.query)[0]}}),watch:{time:function(e){this.fetchData()},value:function(){this.fetchData()}},methods:l()({},Object(r.b)(["getMessageList"]),{handleSizeChange:function(e){this.curPageSize=e,this.fetchData()},handleCurrentChange:function(e){this.currentPage4=e,this.fetchData()},mapPagination:function(){this.currentPage4=this.pageNum,this.curTotal=this.total,this.curPageSize=this.pageSize},computeParams:function(){var e={};return"all"!==this.value&&(e.sendType=this.value),this.time.length>0&&(e.beginTime=this.time[0]+" 00:00:00",e.endTime=this.time[1]+" 23:59:59"),e.page=this.currentPage4,e.size=this.curPageSize,e},createMessage:function(){this.$router.push({path:"/operation/message?createMessage"})},fetchData:function(){var e=this;this.getMessageList(this.computeParams()).then(function(){e.mapPagination()})}}),beforeRouteEnter:function(e,t,a){a(function(e){e.$nextTick(function(){e.fetchData()})})},mounted:function(){var e=this;this.$nextTick(function(){e.fetchData()})}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isLoadSubPage?a("div",{staticClass:"protalPage"},[a("div",{staticClass:"messagePage"},[a("div",{staticClass:"title"},[e._v("\n      消息推送\n    ")]),e._v(" "),a("div",{staticClass:"selects"},[a("div",{staticClass:"statusSelect"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",{staticClass:"timeSelect"},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),e._v(" "),a("div",{staticClass:"buttons"},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"b22a32af-f476-40d1-90ef-a4e82b5c4cdd",expression:"'b22a32af-f476-40d1-90ef-a4e82b5c4cdd'"}],attrs:{type:"primary"},nativeOn:{click:function(t){e.createMessage(t)}}},[e._v("新建消息")])],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isFetchingData,expression:"isFetchingData"},{name:"permission",rawName:"v-permission",value:"a8bf2d59-0195-44b8-8fac-003373eb0c82",expression:"'a8bf2d59-0195-44b8-8fac-003373eb0c82'"}],staticClass:"messageTableBox"},[a("message-table",{attrs:{tableData:e.messageList}}),e._v(" "),a("div",{staticClass:"paginationBox"},[a("el-pagination",{attrs:{"current-page":e.currentPage4,"page-sizes":e.pageSizes,"page-size":e.curPageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.curTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])]):a("message-sub-page",{attrs:{subPageInfo:e.routeQuery},on:{refreshMessage:e.fetchData}})},staticRenderFns:[]};var y=a("VU/8")(b,T,!1,function(e){a("4mSX")},"data-v-f85ffe56",null);t.default=y.exports},Phjk:function(e,t){},x6X7:function(e,t){}});
//# sourceMappingURL=17.d0a6dd46818eb0d4680e.js.map